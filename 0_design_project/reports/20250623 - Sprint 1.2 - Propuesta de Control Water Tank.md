---
created: 20250623 01:06
update: 20250710-05:56
summary: 
status: 
link: 
tags: 
---
# Guía Técnica de la Dinámica Water Tank

## 1. Declaración técnica del problema y supuestos

El objetivo es mantener la altura $h(t)$ del líquido en un estanque vertical en un valor de `setpoint` fijo $h^*$. Para lograrlo se manipula la válvula de entrada: el controlador PID genera un torque $\tau(t)$ y este torque se convierte linealmente en un porcentaje de apertura $u(t)$ dentro del rango 0 a 1. La válvula de salida se deja en una apertura constante $u_{\text{out}}$​; no forma parte de la acción de control.

El tanque se modela como un cilindro de sección transversal constante $A$. El fluido se considera incompresible, con densidad $\rho$ uniforme, y se descartan variaciones de temperatura y efectos de compresibilidad. El suministro llega desde una línea a presión $P_{\text{sup}}$​, suficiente para garantizar flujo hacia el estanque mientras la altura no exceda el nivel correspondiente a esa presión. La gravedad actúa con aceleración $g$.

La dinámica se obtiene aplicando un balance de masa. La tasa de cambio de volumen $A\ \frac{\mathrm{d}h}{\mathrm{d}t}$ es la diferencia entre el caudal másico que ingresa y el que sale. Cada caudal se estima con la ecuación de orificio:

$$\dot m_{\text{in}}(u) = C_d\,u\,\sqrt{2\rho\,(P_{\text{sup}}-\rho g h)},\qquad \dot m_{\text{out}}(h) = C_{d,\text{out}}\,u_{\text{out}}\,\sqrt{2\rho g h}$$

donde $C_d$ y $C_{d,\text{out}}$ son coeficientes de descarga que concentran las pérdidas locales y los efectos de turbulencia. Combinando ambas expresiones se obtiene la ecuación diferencial

$$\frac{\mathrm{d}h}{\mathrm{d}t}=\frac{1}{A}\Bigl[C_d\,u(t)\,\sqrt{2\,(P_{\text{sup}}/\rho - g h)}-C_{d,\text{out}}\,u_{\text{out}}\,\sqrt{2 g h}\Bigl]$$

Se imponen límites físicos: la altura se confina a $0\le h\le h_{\max}$ y el actuador se satura en $0\le u\le 1$. La condición inicial es $h(0)=h_0$​, con ⁡$0<h_0<H_{\max}$​. En el simulador, la clase dinámica debe proporcionar un método `reset()` que asigne $h_0$​ y un método `apply_action(u, dt)` que integre la ecuación anterior durante el intervalo $dt$, devolviendo el nuevo estado. Las firmas y la lógica de estos métodos replican las utilizadas en el sistema de ejemplo CartPole, de modo que el nuevo componente “WaterTank” pueda integrarse sin alterar el resto de la infraestructura.

**Variables y constantes empleadas**:  
- $h$ [m] altura 
- $u$ [–] apertura de entrada 
- $\tau$ [N·m] torque aplicado 
- $A$ [m²] área del tanque 
- $C_{d,\text{out}}$​ [–] coeficientes de descarga 
- $\rho$ [kg m⁻³] densidad
- $g$ [m s⁻²] gravedad
- $P_{\text{sup}}$​ [Pa] presión de línea
- $⁡H_{\max}$​ [m] altura geométrica máxima 
- $u_{\text{out}}$​ [–] apertura fija de salida


## 2. Origen fenomenológico y ecuaciones base

### 2.1 Balance de masa en el estanque

Un estanque de área transversal fija $A$ acumula líquido. El volumen almacenado es $V(t)=A\,h(t)$. El principio de conservación de masa dicta:

$$\frac{\mathrm d}{\mathrm dt}\bigl(\rho V\bigr)=\dot m_{\text{in}}-\dot m_{\text{out}}$$

Con $\rho$ constante (fluido incompresible) esta relación se simplifica a

$$\frac{\mathrm d h}{\mathrm dt}= \dot m_{\text{in}}-\dot m_{\text{out}}$$

La ecuación anterior afirma: **el ritmo al que sube la altura es proporcional a la diferencia entre el caudal que entra y el que sale**.

### 2.2 Ecuación de orificio para los caudales

Cuando un fluido pasa por una abertura relativamente pequeña (válvula u orificio) bajo régimen permanente, la **energía mecánica** entre dos puntos del flujo está regida, en primera aproximación, por la forma simplificada de la ecuación de Bernoulli:

$$P+\tfrac12\rho v^{2}+\rho g z=\text{cte}$$

Negando pérdidas por fricción en la corta distancia del orificio y tomando la descarga a presión atmosférica $P_{\text{atm}}$​ , se obtiene para la velocidad ideal $v_{\text{ideal}}$ ​:

$$v_{\text{ideal}}=\sqrt{\tfrac{2\,(P_{\text{up}}-P_{\text{atm}})}{\rho}}$$

La realidad incluye **contracción y fricción local**; se introduce el _coeficiente de descarga_ $C_{d}\le 1$ que corrige tanto la velocidad como el área efectiva. El caudal másico es entonces

$$\dot m=C_{d}\,A_{o}\,\rho\,v_{\text{ideal}} \;=\;C_{d}\,A_{o}\,\rho\,\sqrt{\tfrac{2\,(P_{\text{up}}-P_{\text{atm}})}{\rho}} \;=\;C_{d}\,A_{o}\,\sqrt{2\rho\,(P_{\text{up}}-P_{\text{atm}})}$$

Para la **válvula de entrada**, el usuario del simulador abre una fracción $u$ del área disponible $A_{o,\text{max}}$ ​. Definimos $A_o​=u\,A_{o,\text{max}}$​ y, absorbiendo $A_{o,\text{max}}$​ dentro de un coeficiente global, escribimos

$$\boxed{\;\dot m_{\text{in}}(u)=C_{d}\,u\,\sqrt{2\rho\,(P_{\text{sup}}-\rho g h)}\;}$$

El término $\rho g h$ representa la contrapresión creada por la columna de líquido ya presente en el tanque.

Para la **válvula de salida**, la presión arriba del orificio es únicamente la columna interna; la apertura es fija $u_{\text{out}}$​. Resulta:

$$\boxed{\;\dot m_{\text{out}}(h)=C_{d,\text{out}}\,u_{\text{out}}\,\sqrt{2\rho g h}\;}$$

### 2.3 Ecuación diferencial fundamental
Sustituyendo ambos caudales en el balance de masa se obtiene la dinámica continua de la altura:

$$\frac{\mathrm d h}{\mathrm dt}= \frac{1}{A}\Bigl[ C_{d}\,u(t)\,\sqrt{2\,(P_{\text{sup}}/\rho-g h)} \;-\; C_{d,\text{out}}\,u_{\text{out}}\,\sqrt{2 g h} \Bigr]$$

Esta ecuación **describe completamente la evolución de $h(t)$** bajo cualquier ley de apertura $u(t)$ dentro de $0\le u\le1$ . Limitar $h$ a $⁡0\le h\le H_{\max}$ asegura coherencia física y numérica.
